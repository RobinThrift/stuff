{{ template "layout.html.tmpl" . }}

{{ define "header" }}
{{ with $.Global.Referer }}
<a href="{{ . }}" class="me-2">
	<x-icon icon="caret-left" class="h-6 w-6" />
</a>
{{ end -}}

{{ with .Data.Asset }}
<h1 class="font-extrabold text-sm sm:text-base md:text-2xl lg:text-4xl flex flex-col items-start sm:flex-row sm:items-center">
	{{ .Name }}
	<span class="hidden lg:inline text-slate-400">#{{ .Tag }}</span>

	{{ template "status_badge" dict "Status" .Status "Class" "hidden lg:block sm:ms-3 sm:mt-2" }}
</h1>

<div class="sm:mt-3 sm:mt-0 flex-1 flex justify-end">
	<x-dropdown-button
		button-class="text-xs md:text-base btn-primary"
		button-text="Actions"
		items='[
			{ "text": "Edit", "url": "(printf \"/assets/%d/edit\" .ID)" },
			{ "text": "Delete", "url": "(printf \"/assets/%d/delete\" .ID)", "class": "text-red-700" }
		]'
	/>
</div>
{{ end }}
{{ end }}

{{ define "main" }}
{{ with .Data.Asset }}
<h4 class="flex lg:hidden flex-row w-full px-3 mb-3 justify-between">
	<span class="text-slate-500">Tag: {{ .Tag }}</span>
	{{ template "status_badge" dict "Status" .Status "Class" "sm:ms-3 sm:mt-2" }}
</h4>

{{ template "asset_view_tabs" $ }}

<div class="main grid grid-cols-1 lg:grid-cols-3 lg:gap-4">
	<dl class="md:grid md:grid-cols-2 md:gap-2 lg:col-span-2 relative">
		<a class="btn btn-muted btn-outline absolute right-0 top-0" href="/assets/{{ .ID }}/edit" title="Edit"><x-icon class="h-6 w-6 !me-0" icon="pencil-simple" /></a>

		<div class="lg:col-span-1 space-y-5">
			{{ with .Parent }}
			<div>
				<dt class="block text-neutral-400 font-semibold">Parent</dt>
				<dd>
					<a href="/assets/{{ .ID }}" class="text-blue-500 hover:text-purple-600">{{ .Name }}#{{ .Tag }}</a>
				</dd>
			</div>
			{{ end }}

			<div>
				<dt class="block text-neutral-400 font-semibold">Name</dt>
				<dd>{{ .Name }}</dd>
			</div>

			{{ if eq .Type "CONSUMABLE" }}
			<div>
				<dt class="block text-neutral-400 font-semibold">Quantity Left</dt>
				<dd>{{ .Quantity }} {{ .QuantityUnit }}</dd>
			</div>
			{{ end }}

			<div>
				<dt class="block text-neutral-400 font-semibold">Category</dt>
				<dd><a href="/assets?query=category:{{ .Category }}">{{ .Category }}</a></dd>
			</div>

			<div>
				<dt class="block text-neutral-400 font-semibold">Location</dt>
				<dd>
					{{ default .Location "-" }}
					{{ if ne .PositionCode "" }}
						({{ .PositionCode }})
					{{ end }}
				</dd>
			</div>
		</div>

		<div class="lg:col-span-1 space-y-5">
			<div>
				<dt class="block text-neutral-400 font-semibold">Manufacturer</dt>
				<dd>{{ default .Manufacturer "-" }}</dd>
			</div>

			<div>
				<dt class="block text-neutral-400 font-semibold">Model</dt>
				<dd>{{ default .Model "-" }} {{ with .ModelNo}} ({{.}}) {{ end }}</dd>
			</div>

			{{ if ne .Type "CONSUMABLE" }}
			<div>
				<dt class="block text-neutral-400 font-semibold">SerialNo</dt>
				<dd>{{ default .SerialNo "-" }}</dd>
			</div>

			<div>
				<dt class="block text-neutral-400 font-semibold">Warranty Until</dt>
				<dd class="sm:col-span-2">
					{{ if not .WarrantyUntil.IsZero }}
						{{ .WarrantyUntil.Format "2006-01-02" }}
					{{ else }}
					-
					{{ end }}
				</dd>
			</div>
			{{ end }}
		</div>

		<div class="lg:col-span-2 mb-5">
			<span class="block text-neutral-400 font-semibold">Notes</span>
			<p>
				{{ range split (default .Notes "-") "\n" }}
				{{ . }}<br />
				{{ end }}
			</p>
		</div>
	</dl>

	<div class="lg:col-span-1">
		{{ if ne .ImageURL "" }}
		<div class="rounded border p-3 w-full">
			<img src="{{ .ImageURL }}" class="w-full h-auto object-scale-down max-h-[500px]" />
		</div>
		{{ end }}
	</div>

	{{ if and (eq (len .Purchases) 1) (ne .Type "CONSUMABLE") }}
	<div class="lg:col-span-2">
		{{ $purchase := index .Purchases 0 }}
		<h3 class="font-bold text-xl mt-8 mb-5">Purchase Info</h3>

		<div class="md:grid md:grid-cols-2 md:gap-2 lg:col-span-2 relative">
			<div class="lg:col-span-1 space-y-5">
				<div>
					<span class="block text-neutral-400 font-semibold">Supplier</span>
					{{ default $purchase.Supplier "-" }}
				</div>

				<div>
					<span class="block text-neutral-400 font-semibold">Purchase Date</span>
					{{ if not $purchase.Date.IsZero }}
						{{ $purchase.Date.Format "2006-01-02" }}
					{{ else }}
					-
					{{ end }}
				</div>
			</div>

			<div class="lg:col-span-1 space-y-5">
				<div>
					<span class="block text-neutral-400 font-semibold">Order No.</span>
					{{ default $purchase.OrderNo "-" }}
				</div>

				<div>
					<span class="block text-neutral-400 font-semibold">Amount</span>
					{{ $purchase.Amount.Format $.Data.DecimalSeparator }} {{ $purchase.Currency }}
				</div>
			</div>
		</div>
	</div>
	{{ else }}
	{{- with .Purchases }}
	<div class="lg:col-span-2">
		<div class="grid grid-cols-1 gap-1 p-3 odd:bg-gray-50 dark:odd:bg-background-200 sm:grid-cols-3 sm:gap-4">
			<h3 class="font-bold text-lg">Purchases</h3>
		</div>

		<table class="min-w-full">
			<thead class="thead">
				<tr>
					<th>Date</th>
					<th>Supplier</th>
					<th>OrderNo</th>
					<th>Amount</th>
				</tr>
			</thead>

		<tbody class="tbody">
			{{ range . }}
				<tr>
					<td class="max-w-[100px]">
						{{- if not .Date.IsZero -}}
						{{ .Date.Format "2006-02-01" }}
						{{- end -}}
					</td>
					<td>{{ .Supplier }}</td>
					<td>{{ .OrderNo }}</td>
					<td class="max-w-[100px]">{{ .Amount.Format $.Data.DecimalSeparator }} {{ .Currency }}</td>
				</tr>
			{{ end }}
			</tbody>
		</table>
	</div>
	{{- end }}
	{{ end }}

	{{ with .Parts }}
	<div class="lg:col-span-3">
		<h2 class="mt-8 mb-5 md:text-xl lg:text-3xl font-bold">Parts</h2>

		<table class="min-w-full">
			<thead class="thead">
				<tr>
					<th>Tag</th>
					<th>Name</th>
					<th>Location</th>
					<th>Notes</th>
				</tr>
			</thead>

		<tbody class="tbody">
			{{ range . }}
				<tr>
					<td>
						<strong>{{ .Tag }}</strong>
					</td>
					<td>
						{{ .Name }}
					</td>
					<td>
						{{  .Location  }}
						{{ if ne .PositionCode "" }}
							({{ .PositionCode }})
						{{ end }}
					</td>
					<td>
						{{ .Notes }}
					</td>
				</tr>
			{{ end }}
			</tbody>
		</table>
	</div>
	{{ end }}

	{{ with .Children }}
	<div class="lg:col-span-3 flex flex-col">
		<div class="mt-5 rounded w-full">
			<h3 class="mb-5 md:text-md lg:text-xl font-bold">Assets belonging to this Asset</h3>
			<ul>
			{{ range . }}
				<li>
					<a href="/assets/{{ .ID }}" class="text-blue-500 hover:text-purple-600">{{ .Name }} ({{ .Tag }})</a>
				</li>
			{{ end }}
			</ul>
		</div>
	</div>
	{{ end }}
</div>

{{ end }}
{{ end }}

{{ define "asset_view_tabs" }}
{{ with .Data.Asset }}
<nav class="content-inset-x mb-5 w-full border-b border-gray-100 dark:border-primary-700">
	<ul class="flex flex-wrap justify-start space-x-5">
		<li class="flex border-b-2 text-base border-primary-500 text-primary-500">
			<a class="px-2 pb-2 inline-flex items-center" href="/assets/{{ .ID }}">Details</a>
		</li>
		<li class="flex border-b-2 text-base border-transparent text-neutral-400 hover:text-primary-600 hover:border-primary-600">
			<a class="px-2 pb-2 inline-flex items-center" href="/assets/{{ .ID }}/files">Files</a>
		</li>
	</ul>
</nav>
{{ end }}
{{ end }}

