{{ template "document_head" . }}
<div class="min-h-screen sm:h-screen flex">
	<nav class="sm:w-56 lg:w-60 flex-none">
		{{ template "sidebar" . }}
	</nav>

	<main class="sm:overflow-auto flex-1 flex flex-col">
		<main id="main" class="px-3 md:px-6 lg:px-8 pb-5 flex-1">
			<header class="my-5 flex flex-row items-start justify-start lg:items-center">
				{{ block "header" . }}{{ end }}
			</header>

			{{ block "main" . }}{{ end }}
		</main>
		{{ template "footer" . }}
	</main>
</div>
{{ template "command_palette" }}

{{ template "document_footer" . }}

{{ define "sidebar" }}
<div class="flex h-screen flex-col justify-between border-e bg-white" x-data="{ open: $persist({}) }">
	<div class="px-4 py-6">
		<a class="block" href="/">
			{{ template "logo" dict "Class" "text-xl justify-start" "IconClass" "h-6"}}
		</a>
	
		<ul class="mt-6 space-y-1">
			<li>
				<button
					class="flex w-full items-center justify-between rounded px-4 py-2 text-gray-500 hover:bg-gray-100 hover:text-gray-700"
					x-on:click="open['assets'] = !open['assets']"
				>
					<span class="text-sm font-medium">Assets</span>
					<x-icon icon="caret-down" class="mr-1 w-[16px] h-[16px] shrink-0 transition duration-300" x-bind:class=" { 'rotate-180' : open['assets'] }" />
				</button>

				<ul x-cloak x-show="open['assets']" class="mt-2 space-y-1 ps-4">
					<li>
						<a
							href="/assets"
							{{ if eq $.Global.CurrentPage "/assets" }}
							class="block rounded px-4 py-2 text-sm font-medium bg-gray-100 text-gray-700"
							{{ else }}
							class="block rounded px-4 py-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700"
							{{ end }}
						>
							List Assets
						</a>
					</li>
					<li>
						<a
							href="/assets/new"
							{{ if eq $.Global.CurrentPage "/assets/new" }}
							class="block rounded px-4 py-2 text-sm font-medium bg-gray-100 text-gray-700"
							{{ else }}
							class="block rounded px-4 py-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700"
							{{ end }}
						>
							New Assset
						</a>
					</li>
				</ul>
			</li>

			<li>
				<a
					href="/tags"
					{{ if eq $.Global.CurrentPage "/tags" }}
					class="block rounded px-4 py-2 text-sm font-medium bg-gray-100 text-gray-700"
					{{ else }}
					class="block rounded px-4 py-2 text-sm font-medium text-gray-500 hover:bg-gray-100 hover:text-gray-700"
					{{ end }}
				>
					Tags
				</a>
			</li>
		</ul>
	</div>

	<div class="sticky inset-x-0 bottom-0 border-t border-gray-100">
		<a class="px-2 py-2 text-sm text-neutral hover:text-purple-500 flex flex-row items-center" href="/logout">
			<x-icon icon="sign-out" class="mr-1 w-[16px] h-[16px] rotate-180" />
			Logout
		</a>
	</div>
</div>
{{ end }}

{{ define "footer" }}
<footer class="px-3 md:px-6 lg:px-8 py-5 bg-gray-50 w-full">
	<div class="flex flex-wrap justify-center text-sm">
		{{ template "logo" dict "Class" "text-sm" "IconClass" "h-0" }}
		<span class="px-5">Version X</span>
		<a href="https://github.com/kodeshack/stuff" class="inline-block group flex flex-row justify-center items-center text-blue-400 hover:text-purple-500" rel="noopener noreferrer">
			<x-icon icon="github-logo-duotone" class="h-[16px] w-[16px] !hidden group-hover:!inline-block" />
			<x-icon icon="github-logo" class="h-[16px] w-[16px] group-hover:!hidden" />
			GitHub
		</a>
	</div>
</footer>
{{ end }}


{{ define "command_palette" }}
<div
	class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex min-h-[370px] justify-center w-full max-w-xl items-start"
	x-cloak
	x-data="commandpalette"
	x-show="show"

	x-on:keydown.down.prevent="selectNext()" 
	x-on:keydown.up.prevent="selectPrev()" 
	x-on:keydown.enter.prevent="exec()" 
	x-on:keydown.escape.prevent="show = false" 
	x-on:keydown.window.prevent.meta.k="show = true; setTimeout(() => { $refs.input.focus() }, 100)"
	x-on:click.outside="show = false"
>
	<div class="flex flex-col w-full h-full overflow-hidden bg-white border rounded shadow-md">
		<div class="flex items-center px-3 border-b">
			<x-icon icon="magnifying-glass" class="w-[24px] h-[24px] text-neutral-400" />
			<input x-model="search" x-ref="input" type="text" class="input h-11 bg-transparent border-0 outline-none focus:outline-none shadow-none focus:ring-0" placeholder="Type a command or search..." autocomplete="off" autocorrect="off" spellcheck="false">
		</div>

		<div x-ref="cmdsList" class="max-h-[320px] overflow-y-auto overflow-x-hidden">
			<div x-show="shown.length === 0">
				<span class="px-2 py-1 my-1 text-neutral-400">Search for <strong x-text="search"></strong></span>
			</div>
			<template x-for="(cat, i) in shown" :key="cat[0]">
				<ul class="space-y-1">
					<li class="block px-2 py-1 my-1 font-medium text-neutral-500" x-text="cat[0]"></li>
					<template x-for="(cmd, j) in cat[1]" :key="cmd.name">
						<li
							x-on:click="curr=[i, j]; exec()"
							x-on:mousemove="curr=[i, j]"
							x-bind:class="{ 'bg-neutral-100 text-gray-900 command-palette-active': curr && curr[0] == i && curr[1] == j  }"
							class="px-1 flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 outline-none"
						>
							<svg class="h-[24px] w-[24px]">
								<use x-bin:xlink:href="`/static/icons.svg#${cmd.icon}`"></use>
							</svg>
							<span x-html="cmd.name"></span>
						</li>
					</template>
				</ul>
			</template>
		</div>
	</div>
</div>
{{ end }}
